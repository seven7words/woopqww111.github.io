<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      最近关于Lua的学习篇总结（三） | Seven_words的博客 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="Seven_words/woopqww111">
    
    

    <meta name="description" content="最近关于Lua的学习篇总结（三)lua和.Net的相互调用由于我们公司主要是用ulua进行热更新，所以不可避免的就是luainterface呢
luainterfaceluainterface包括两个核心库，一个是luainterface.dll,一个是luanet.dll可以通过luainterface完成lua和C#的相互调用
在C#中执行访问lua代码Lua lua = new Lua();">
<meta property="og:type" content="article">
<meta property="og:title" content="最近关于Lua的学习篇总结（三） | Seven_words的博客">
<meta property="og:url" content="http://yoursite.com/2017/04/21/关于lua的总结三/index.html">
<meta property="og:site_name" content="Seven_words的博客">
<meta property="og:description" content="最近关于Lua的学习篇总结（三)lua和.Net的相互调用由于我们公司主要是用ulua进行热更新，所以不可避免的就是luainterface呢
luainterfaceluainterface包括两个核心库，一个是luainterface.dll,一个是luanet.dll可以通过luainterface完成lua和C#的相互调用
在C#中执行访问lua代码Lua lua = new Lua();">
<meta property="og:updated_time" content="2017-04-21T05:54:16.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="最近关于Lua的学习篇总结（三） | Seven_words的博客">
<meta name="twitter:description" content="最近关于Lua的学习篇总结（三)lua和.Net的相互调用由于我们公司主要是用ulua进行热更新，所以不可避免的就是luainterface呢
luainterfaceluainterface包括两个核心库，一个是luainterface.dll,一个是luanet.dll可以通过luainterface完成lua和C#的相互调用
在C#中执行访问lua代码Lua lua = new Lua();">
    
    
    
      <link rel="icon" type="image/x-icon" href="/favicon.png">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">Seven_words的博客</a></h1>
        <hr class="panel-cover__divider" />

        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">首页</a></li>
              
                
                <li class="navigation__item"><a href="/about" title="" class="">关于</a></li>
              
                
                <li class="navigation__item"><a href="/archive" title="" class="">归档</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">最近关于Lua的学习篇总结（三）</h1>

    

    <div class="post-meta">
      <time datetime="2017-04-21" class="post-meta__date date">2017-04-21</time> 

      <span class="post-meta__tags tags">

          

          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <h1 id="最近关于Lua的学习篇总结（三"><a href="#最近关于Lua的学习篇总结（三" class="headerlink" title="最近关于Lua的学习篇总结（三)"></a>最近关于Lua的学习篇总结（三)</h1><h2 id="lua和-Net的相互调用"><a href="#lua和-Net的相互调用" class="headerlink" title="lua和.Net的相互调用"></a>lua和.Net的相互调用</h2><p>由于我们公司主要是用ulua进行热更新，所以不可避免的就是luainterface呢</p>
<h3 id="luainterface"><a href="#luainterface" class="headerlink" title="luainterface"></a>luainterface</h3><p>luainterface包括两个核心库，一个是luainterface.dll,一个是luanet.dll<br>可以通过luainterface完成lua和C#的相互调用</p>
<h3 id="在C-中执行访问lua代码"><a href="#在C-中执行访问lua代码" class="headerlink" title="在C#中执行访问lua代码"></a>在C#中执行访问lua代码</h3><p>Lua lua = new Lua();    //创建Lua解析器<br>    lua[“num”]=2;   //定义一个num<br>    lua[“str”]=”a string”;  //定义一个字符串<br>    lua.newTable(“tab”);    //创建一个表  tab={}</p>
<h3 id="取得lua环境中的变量"><a href="#取得lua环境中的变量" class="headerlink" title="取得lua环境中的变量"></a>取得lua环境中的变量</h3><p>double num = (double)lua[“num”];</p>
<p>string str = (string)lua[“str”];</p>
<h3 id="在C-中执行Lua脚本文件-或者脚本字符串"><a href="#在C-中执行Lua脚本文件-或者脚本字符串" class="headerlink" title="在C#中执行Lua脚本文件,或者脚本字符串"></a>在C#中执行Lua脚本文件,或者脚本字符串</h3><p>在C#中执行Lua脚本文件,或者脚本字符串<br>lua.DoFile(“script.lua”);//执行script.lua脚本</p>
<pre><code>lua.DoString(&quot;num=2&quot;);

lua.DoString(&quot;str=&apos;a string&apos;&quot;);

object[] retVals = lua.DoString(&quot;return num,str&quot;);
</code></pre><p>在热更新中，只需要写好解析lua脚本的代码，然后c#代码不需要变动，只需要修改lua脚本就好，通过lua脚本控制游戏逻辑。</p>
<h1 id="lua和C-中类型的对应"><a href="#lua和C-中类型的对应" class="headerlink" title="lua和C#中类型的对应"></a>lua和C#中类型的对应</h1><p>lnil        null</p>
<pre><code>string      System.String

number      System.Double

boolean         System.Boolean

table       LuaInterface.LuaTable

function        LuaInterface.LuaFunction
</code></pre><h1 id="把一个C-方法注册进Lua的一个全局方法"><a href="#把一个C-方法注册进Lua的一个全局方法" class="headerlink" title="把一个C#方法注册进Lua的一个全局方法"></a>把一个C#方法注册进Lua的一个全局方法</h1><p>//把一个类中的普通方法注册进去<br>lua.RegisterFunction(“NormalMethod”,obj,obj.GetType().GetMethod(“NormalMethod”))<br>lua.DoString(“ NormalMethod()”);</p>
<p>//把一个类的静态方法注册进去<br>lua.RegisterFunction(“StaticMethod”,null,typeof(ClassName).GetMethod(“StaticMethod”))<br>lua.DoString(“ StaticMethod()”)</p>
<h1 id="在Lua中使用c-中的类"><a href="#在Lua中使用c-中的类" class="headerlink" title="在Lua中使用c#中的类"></a>在Lua中使用c#中的类</h1><p>require “luanet”<br>–加载CLR的类型、实例化CLR对象<br>luanet.load_assembly(“System.Windows.Forms”)<br>luanet.load_assembly(“System.Drawing”)<br>Form = luanet.import_type(“System.Windows.Forms.Form”)<br>StartPosition = luanet.import_type(“System.Windows.Forms.FormStartPosition”)</p>
<p>print(Form)<br>print(StartPosition)<br>在Lua中使用C#中的类创建对象的时候，会自动匹配最合适的构造方法</p>
<h1 id="在Lua中访问C-中的属性和方法"><a href="#在Lua中访问C-中的属性和方法" class="headerlink" title="在Lua中访问C#中的属性和方法"></a>在Lua中访问C#中的属性和方法</h1><p>Lua代码中，访问C#对象的属性的方式和访问table的键索引一样，比如obj.name 或者 obj[“name”]</p>
<p>Lua代码中，访问C#对象的普通函数的方式和调用table的函数一样，比如obj:method1()</p>
<h1 id="在Lua中访问C-中的方法-特殊情况"><a href="#在Lua中访问C-中的方法-特殊情况" class="headerlink" title="在Lua中访问C#中的方法-特殊情况"></a>在Lua中访问C#中的方法-特殊情况</h1><p>当函数中有out或ref参数时，out参数和ref参数和函数的返回值一起返回，并且调用的时候，out参数不需要传入<br>C#函数定义<br>class Obj{<br>int OutMethod1(int parameter1,out parameter2,out parameter3){<br>    parameter2=34;parameter3=213;<br>    return parameter1;<br>}<br>int OutMethod2(int parameter1,ref parameter2){<br>    parameter2=parameter2+2;<br>    return parameter1+parameter2;<br>}<br>}<br>Lua中的调用和返回值<br>obj:OutMethod1(34)<br> –out参数不需要参数，这个返回一个table，里面的值为parameter1,parameter2,parameter3<br>(34,34,213)</p>
<p>obj:OutMethod2(10,10)<br>–ref参数需要传入，返回一个table有两个值(value1,value2)</p>
<h1 id="在Lua中访问C-中的方法-特殊情况-1"><a href="#在Lua中访问C-中的方法-特殊情况-1" class="headerlink" title="在Lua中访问C#中的方法-特殊情况"></a>在Lua中访问C#中的方法-特殊情况</h1><p>当有重载函数的时候，调用函数会自动匹配第一个能匹配的函数</p>
<p>可以使用get_method_bysig函数得到C#中指定类的指定参数的函数用法<br>luaMethod = get_method_bysig(Obj,”CSharpMethod”,”System.String”)<br>                  luaMethod(“siki”)</p>
<h1 id="在Lua中注册C-中的事件委托（event-delegate）"><a href="#在Lua中注册C-中的事件委托（event-delegate）" class="headerlink" title="在Lua中注册C#中的事件委托（event delegate）"></a>在Lua中注册C#中的事件委托（event delegate）</h1><p>在Lua中通过Add方法或者Remove方法把一个Lua的函数注册或者注销从C#中的事件委托中<br>function method()<br>end<br>obj.SomeEvent:Add(methodname(不用带引号))<br>私人学习笔记而已。</p>

  </section>

  <section class="post-comments">

    <!-- 将评论系统（例如Disqus、多说、友言、畅言等）提供的代码片段粘贴在这里 -->
    
</section>


</article>


            <footer class="footer">

    <span class="footer__copyright">&copy; 2014-2015. | 由<a href="https://hexo.io/">Hexo</a>强力驱动 | 主题<a href="https://github.com/someus/huno">Huno</a></span>
    
</footer>
        </div>
    </div>

    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>
    

    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>


    

    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
